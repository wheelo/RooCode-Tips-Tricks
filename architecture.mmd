---
config:
  layout: elk
---
flowchart TD
    A["<b>Extension Entry</b><br>src/extension.ts"] --> B["åˆ›å»ºClineProvider"] & C["æ³¨å†Œå‘½ä»¤å’Œä»£ç æ“ä½œ<br>src/activate/registerCommands.ts<br>src/activate/registerCodeActions.ts"] & D["è®¾ç½®å›½é™…åŒ–"] & E["åˆå§‹åŒ–ç»ˆç«¯æ³¨å†Œè¡¨<br>src/integrations/terminal/TerminalRegistry.ts"] & F@{ label: "æ³¨å†Œ<span style=\"color:\">DiffViewProvider</span><br>src/integrations/editor/DiffViewProvider.ts" } & CLI_ROOT["<b>CLI System</b><br>å‘½ä»¤è¡Œç³»ç»Ÿ"] & PKG_MGR["<b>Package Manager</b><br>åŒ…ç®¡ç†å™¨"] & TERMINAL_INT["<b>Terminal Integration</b><br>ç»ˆç«¯é›†æˆ"] & GLOBAL_CONFIG["<b>Global Config</b><br>å…¨å±€é…ç½®ç³»ç»Ÿ"]
    B --> G["<b>ğŸ¯ ClineProvider</b><br><b>æ ¸å¿ƒæ§åˆ¶å™¨</b><br>src/core/webview/ClineProvider.ts"]
    G --> I["å¤„ç†UIæ¶ˆæ¯"] & J["ç»´æŠ¤Clineå®ä¾‹æ ˆ"] & K["åè°ƒä»»åŠ¡æ‰§è¡Œ<br>src/core/task/Task.ts#L124"] & TT["ContextProxy<br>src/core/context/ContextProxy.ts"] & UU["WorkspaceTracker<br>src/core/workspace/WorkspaceTracker.ts"]
    J --> S["<b>Task Engine</b><br>src/core/task/Task.ts#L124"]
    S --> T["ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†<br>â€¢ åˆå§‹åŒ–çŠ¶æ€<br>â€¢ æ‰§è¡Œä¸­çŠ¶æ€<br>â€¢ å®ŒæˆçŠ¶æ€<br>â€¢ é”™è¯¯çŠ¶æ€"] & U["å¤„ç†ç”¨æˆ·è¾“å…¥<br>src/core/webview/webviewMessageHandler.ts"] & V["å‘é€APIè¯·æ±‚"] & W["è°ƒç”¨å·¥å…·"] & X["ç®¡ç†ä»»åŠ¡çŠ¶æ€"] & VV["FileContextTracker<br>src/core/task/FileContextTracker.ts"] & WW["ToolRepetitionDetector<br>src/core/tools/ToolRepetitionDetector.ts"]
    W --> Y["<b>Tools System</b><br>src/core/tools/"]
    X --> STORAGE["<b>Storage System</b><br>å­˜å‚¨ç³»ç»Ÿ"]
    I --> SS["<b>webviewMessageHandler</b><br>src/core/webview/webviewMessageHandler.ts"]
    G -. ç®¡ç†webviewè§†å›¾ .-> L["Webview UI<br>webview-ui/src/App.tsx"]
    L --> M["ChatViewç»„ä»¶<br>webview-ui/src/components/ChatView/ChatView.tsx"]
    M --> Q["ChatTextArea<br>webview-ui/src/components/ChatView/ChatTextArea.tsx"] & R["ChatRow<br>webview-ui/src/components/ChatView/ChatRow.tsx"] & N["HistoryViewç»„ä»¶<br>webview-ui/src/components/HistoryView/HistoryView.tsx"]
    N --> O["SettingsViewç»„ä»¶<br>webview-ui/src/components/SettingsView/SettingsView.tsx"]
    O --> P["MarketplaceViewç»„ä»¶<br>webview-ui/src/components/MarketplaceView/MarketplaceView.tsx"]
    Y --> Z["readFileTool<br>src/core/tools/readFileTool.ts"] & AA["writeToFileTool<br>src/core/tools/writeToFileTool.ts"] & BB["executeCommandTool<br>src/core/tools/executeCommandTool.ts"] & CC["codebaseSearchTool<br>src/core/tools/codebaseSearchTool.ts"] & DD["applyDiffTool<br>src/core/tools/applyDiffTool.ts"] & EE["insertContentTool<br>src/core/tools/insertContentTool.ts"] & FF["searchAndReplaceTool<br>src/core/tools/searchAndReplaceTool.ts"] & GG["listFilesTool<br>src/core/tools/listFilesTool.ts"]
    STORAGE --> CHECKPOINTS["<b>Checkpoints</b><br>src/core/storage/checkpoints/<br>â€¢ ä»»åŠ¡æ£€æŸ¥ç‚¹<br>â€¢ çŠ¶æ€å¿«ç…§<br>â€¢ å›æ»šæœºåˆ¶"] & TASK_STORAGE["<b>Task Storage</b><br>src/core/storage/task/<br>â€¢ taskMessages.ts<br>â€¢ apiMessages.ts<br>â€¢ taskMetadata.ts"] & VSCODE_STORAGE["<b>VSCode Storage</b><br>VSCodeå­˜å‚¨ç³»ç»Ÿ"]
    C --> CLI_ROOT & TERMINAL_INT & Y
    V --> HH["API Handler<br>src/api/"]
    HH --> II["ApiHandleræ¥å£<br>src/api/index.ts"] & JJ["API Providers<br>src/api/providers/"]
    JJ --> KK["anthropic.ts<br>src/api/providers/anthropic.ts"] & LL["openai.ts<br>src/api/providers/openai.ts"] & NN["å…¶ä»–æä¾›å•†<br>src/api/providers/"]
    GLOBAL_CONFIG --> ROO_CONFIG["<b>.rooé…ç½®ç³»ç»Ÿ</b><br>.roo/rules/<br>â€¢ ä»£ç è§„åˆ™å®šä¹‰<br>â€¢ æ–‡æ¡£æå–è§„åˆ™<br>â€¢ é›†æˆæµ‹è¯•è§„åˆ™<br>â€¢ é—®é¢˜ä¿®å¤è§„åˆ™<br>â€¢ PRå®¡æŸ¥è§„åˆ™<br>â€¢ ç¿»è¯‘è§„åˆ™"] & GLOBAL_SETTINGS["<b>globalConfig</b><br>src/core/config/<br>â€¢ ç”¨æˆ·åå¥½è®¾ç½®<br>â€¢ APIé…ç½®<br>â€¢ å·¥ä½œåŒºè®¾ç½®<br>â€¢ æ‰©å±•é…ç½®"]
    CLI_ROOT --> PKG_MGR & EVALS_CLI["<b>Evals CLI</b><br>è¯„ä¼°å‘½ä»¤è¡Œ"] & TERMINAL_INT
    PKG_MGR --> ROOT_PKG["package.json<br>æ ¹åŒ…é…ç½®"] & EVALS_CLI
    EVALS_CLI --> EVALS_ENTRY["packages/evals/src/cli/index.ts<br>CLIå…¥å£"]
    EVALS_ENTRY --> RUN_CI["packages/evals/src/cli/runCi.ts<br>CIè¿è¡Œå™¨"] & RUN_EVALS["packages/evals/src/cli/runEvals.js<br>è¯„ä¼°è¿è¡Œå™¨"] & RUN_TASK["packages/evals/src/cli/runTask.js<br>ä»»åŠ¡è¿è¡Œå™¨"]
    E --> TERMINAL_INT
    TERMINAL_INT --> TERM_REG["src/integrations/terminal/TerminalRegistry.ts<br>ç»ˆç«¯æ³¨å†Œè¡¨"] & TERM_PROC["src/integrations/terminal/TerminalProcess.ts<br>ç»ˆç«¯è¿›ç¨‹"] & SHELL_INT["src/integrations/terminal/ShellIntegrationManager.ts<br>Shellé›†æˆ"] & BB
    Q -. ç”¨æˆ·è¾“å…¥ .-> SS
    SS -. è½¬å‘æ¶ˆæ¯ .-> S
    S -. APIè¯·æ±‚ .-> HH
    HH -. å“åº” .-> S
    S -. æ›´æ–°çŠ¶æ€ .-> G
    G -. UIæ›´æ–° .-> M
    S -. é€‰æ‹©å·¥å…· .-> Y
    Y -. æ‰§è¡Œæ“ä½œ .-> XX["æ–‡ä»¶ç³»ç»Ÿ/å‘½ä»¤è¡Œ"]
    XX -. ç»“æœè¿”å› .-> S
    S -. æŒä¹…åŒ– .-> STORAGE
    STORAGE -. æ£€æŸ¥ç‚¹ä¿å­˜ .-> CHECKPOINTS
    STORAGE -. ä»»åŠ¡æ•°æ® .-> TASK_STORAGE
    STORAGE -. VSCodeå­˜å‚¨ .-> VSCODE_STORAGE
    VSCODE_STORAGE -. å…¨å±€çŠ¶æ€ .-> GLOBAL_STATE["<b>VSCode Global State</b><br>"]
    VSCODE_STORAGE -. å¯†é’¥å­˜å‚¨ .-> SECRETS_STORAGE["<b>VSCode Secrets Storage</b><br>"]
    TERM_REG -. è¿›ç¨‹ç®¡ç† .-> TERM_PROC
    TERM_PROC -. Shellé›†æˆ .-> SHELL_INT
    ROO_CONFIG -. è§„åˆ™åº”ç”¨ .-> Y
    GLOBAL_SETTINGS -. é…ç½®è¯»å– .-> G
    F@{ shape: rect}
     A:::entryPoint
     CLI_ROOT:::cli
     PKG_MGR:::cli
     TERMINAL_INT:::cli
     GLOBAL_CONFIG:::config
     G:::coreController
     TT:::core
     UU:::core
     S:::engine
     VV:::core
     WW:::tools
     Y:::tools
     STORAGE:::storage
     SS:::controller
     L:::ui
     M:::ui
     Q:::ui
     R:::ui
     N:::ui
     O:::ui
     P:::ui
     Z:::tools
     AA:::tools
     BB:::tools
     CC:::tools
     DD:::tools
     EE:::tools
     FF:::tools
     GG:::tools
     CHECKPOINTS:::storage
     TASK_STORAGE:::storage
     VSCODE_STORAGE:::vscodeStorage
     GLOBAL_STATE:::vscodeStorage
     HH:::api
     II:::api
     JJ:::api
     KK:::api
     LL:::api
     NN:::api
     ROO_CONFIG:::config
     GLOBAL_SETTINGS:::config
     EVALS_CLI:::cli
     ROOT_PKG:::cli
     EVALS_ENTRY:::cli
     RUN_CI:::cli
     RUN_EVALS:::cli
     RUN_TASK:::cli
     TERM_REG:::cli
     TERM_PROC:::cli
     SHELL_INT:::cli
     SECRETS_STORAGE:::vscodeStorage
    classDef entryPoint fill:#e1f5fe
    classDef coreController fill:#ffeb3b,stroke:#f57f17,stroke-width:3px
    classDef controller fill:#f3e5f5
    classDef ui fill:#e8f5e8
    classDef engine fill:#fff3e0
    classDef tools fill:#fce4ec
    classDef api fill:#f1f8e9
    classDef storage fill:#fff8e1,stroke:#ff8f00,stroke-width:2px
    classDef vscodeStorage fill:#fce4ec,stroke:#e91e63,stroke-width:3px
    classDef core fill:#f0f4c3
    classDef cli fill:#e8eaf6,stroke:#3f51b5,stroke-width:2px
    classDef config fill:#e0f2f1,stroke:#00695c,stroke-width:2p
